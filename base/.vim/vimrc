" {{{ General
let g:tar_cmd = 'bsdtar' " Workaround 'unknown extended header' error
set guifont=Fantasque\ Sans\ Mono\ 12
set guioptions-=e " Use 'a non-GUI tab pages line'
set hidden        " Allow hidden buffers
set history=500
set laststatus=2  " Always show status line
set showtabline=2 " .. and tab pages line
set mouse=a       " Enable mouse (esp. for balloons and scrolling in popups)
set ttymouse=sgr  " .. also in 'terminals that emit SGR-styled mouse reporting'
set noshowmode    " Do not echo the mode, status line will display it instead

" Search
set hlsearch      " Highlight matches
set incsearch     " .. while typing
set ignorecase    " Ignore case
set smartcase     " .. unless 'the search pattern contains upper case characters'
set shortmess-=S  " 'Show search count message when searching'

" True colors
scriptencoding utf-8
let &t_8f = '[38;2;%lu;%lu;%lum'
let &t_8b = '[48;2;%lu;%lu;%lum'
scriptencoding
set termguicolors

" Two-space indentation
set autoindent
set expandtab
set shiftwidth=2
set softtabstop=2
" }}}

" {{{ Plugin management
call plug#begin('~/.vim/plugged')
Plug 'dense-analysis/ale'
let g:ale_set_balloons = 1

Plug 'hotwatermorning/auto-git-diff'
Plug 'ntpeters/vim-better-whitespace'
Plug 'moll/vim-bbye'
Plug 'liuchengxu/vim-clap', { 'tag': '*', 'do': ':call clap#installer#build_python_dynamic_module()' }
Plug 'rhysd/clever-f.vim'
Plug 'kalekundert/vim-coiled-snake'
Plug 'rhysd/committia.vim'
Plug 'maralla/completor.vim'
let g:completor_complete_options = 'menuone,noselect,popup'
let g:completor_filetype_map = {
  \ 'sh': {'ft': 'ale'},
  \ 'python': {'ft': 'ale'},
  \ 'rust': {'ft': 'ale'},
  \ }

Plug 'romainl/vim-cool'
Plug 'rbong/vim-crystalline'
let g:crystalline_statusline_fn = 'StatusLine'
let g:crystalline_tabline_fn = 'TabLine'
let g:crystalline_theme = 'gruvbox'

Plug 'ap/vim-css-color'
Plug 'tpope/vim-dispatch'
Plug 'junegunn/vim-easy-align'
nmap ga <Plug>(EasyAlign)
xmap ga <Plug>(EasyAlign)

Plug 'Shougo/echodoc.vim'
Plug 'haya14busa/vim-edgemotion'
map <C-j> <Plug>(edgemotion-j)
map <C-k> <Plug>(edgemotion-k)

Plug 'editorconfig/editorconfig-vim'
Plug 'Konfekt/FastFold'
Plug 'Jorengarenar/fauxClip'
Plug 'lambdalisue/fern.vim' | Plug 'lambdalisue/fern-renderer-nerdfont.vim'
let g:fern#renderer = 'nerdfont'

Plug 'tpope/vim-fugitive' | Plug 'junegunn/gv.vim'
Plug 'shumphrey/fugitive-gitlab.vim' | Plug 'tpope/vim-rhubarb'
Plug 'rhysd/git-messenger.vim'
Plug 'airblade/vim-gitgutter'
let g:gitgutter_preview_win_floating = 1

Plug 'lambdalisue/glyph-palette.vim'
augroup my-glyph-palette
    autocmd! *
    autocmd FileType fern call glyph_palette#apply()
augroup END

Plug 'junegunn/goyo.vim' | Plug 'junegunn/limelight.vim'
Plug 'gruvbox-community/gruvbox'
let g:gruvbox_italic = 1

Plug 'RRethy/vim-illuminate'
Plug 'machakann/vim-highlightedyank'
Plug 'Yggdroot/indentLine'
let g:indentLine_char_list = ['|', 'Â¦', 'â”†', 'â”Š']
let g:indentLine_bufTypeExclude = ['help']

Plug 'andymass/vim-matchup'
let g:matchup_matchparen_offscreen = { 'method': 'popup' }

if executable('code-minimap')
  Plug 'wfxr/minimap.vim'
endif
Plug 'markwu/vim-mrufiles'
Plug 'lambdalisue/nerdfont.vim'
Plug 'junegunn/vim-peekaboo'
Plug 'blueyed/vim-qf_resize'
Plug 'itchyny/vim-qfedit'
Plug 'unblevable/quick-scope'
Plug 'AndrewRadev/quickpeek.vim'
Plug 'tpope/vim-repeat'
Plug 'rhysd/reply.vim'
Plug 'tpope/vim-rsi'
Plug 'matthew-brett/vim-rst-sections'
Plug 'arzg/vim-rust-syntax-ext'
Plug 'psliwka/vim-smoothie'
Plug 'justinmk/vim-sneak'
Plug 'AndrewRadev/splitjoin.vim'
Plug 'aymericbeaumet/vim-symlink'
Plug 'dhruvasagar/vim-table-mode'
Plug 'tmux-plugins/vim-tmux-focus-events'
Plug 'cespare/vim-toml'
Plug 'markonm/traces.vim'
Plug 'andymass/vim-tradewinds'
Plug 'SirVer/ultisnips' | Plug 'honza/vim-snippets'
Plug 'tpope/vim-unimpaired'
Plug 'liuchengxu/vista.vim'
let g:vista_executive_for = {
  \ 'sh': 'ale',
  \ 'python': 'ale',
  \ 'rust': 'ale',
  \ }

Plug 'dhruvasagar/vim-zoom'
call plug#end()
colorscheme gruvbox
" }}}

" {{{ Status and tab pages lines
function! StatusLine(current, width)
  let l:s = ''

  if a:current
    let l:s .= crystalline#mode() . crystalline#right_mode_sep('')
  else
    let l:s .= '%#CrystallineInactive#'
  endif
  let l:s .= ' %t%h%w%m%r '
  if a:current
    let l:s .= '%{zoom#statusline()}' . crystalline#right_sep('', 'Fill')
    if a:width > 80
      let l:s .= '%{MyGitStatusline()}'
    endif
  endif

  let l:s .= '%='
  if a:current
    if a:width > 80
      let l:s .= '%{get(b:, "vista_nearest_method_or_function", "")} '
    endif
    let l:s .= crystalline#left_sep('', 'Fill') . ' %{&paste ?"PASTE ":""}%{&spell?"SPELL ":""}'
    let l:s .= crystalline#left_mode_sep('')
  endif
  if a:width > 80
    let l:s .= ' %{strlen(&filetype) ? &filetype . " " . nerdfont#find() . " " : ""}'
    let l:s .= '[%{&fenc!=#""?&fenc:&enc}][%{nerdfont#fileformat#find()} ]'
  else
  endif
  let l:s .= ' %l/%L %c%V %P '

  return l:s
endfunction

function! TabLabel(buf, max_width) abort
    let [l:left, l:name, l:short_name, l:right] = crystalline#default_tablabel_parts(a:buf, a:max_width)
    return l:left . l:short_name . ' ' . nerdfont#find(l:name) . (l:right ==# ' ' ? '' : ' ') . l:right
endfunction

function! TabLine() abort
    return crystalline#bufferline(0, 0, 0, 1, 'TabLabel', crystalline#default_tabwidth() + 3)
endfunction

function! MyGitStatusline() abort
  if &modifiable && exists('b:git_dir')
    let l:out = ''
    if g:gitgutter_enabled
      let [ l:added, l:modified, l:removed ] = GitGutterGetHunkSummary()
      let l:out .= printf('+%d ~%d -%d ', l:added, l:modified, l:removed)
    endif
    let l:branch = FugitiveHead()
    let l:out .= l:branch !=# '' ? "\ue0a0 " . l:branch : ''
    return !empty(l:out) ? ' ' . l:out : ''
  else
    return ''
  endif
endfunction

let g:zoom#statustext = "\uf848 "
" }}}

" vim: fdm=marker

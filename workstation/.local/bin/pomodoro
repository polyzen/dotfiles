#!/usr/bin/env bash

set -e

INTERVALS=('Po' 'mo' 'do' 'ro')
WORKMSG='üîç Focus'
WORKTIME='25m'
SHORTBREAKMSG='üßò Stretch'
SHORTBREAKTIME='5m'
LONGBREAKMSG='üíÜ Rest'
LONGBREAKTIME='15m'

BEEP=0
if [[ $1 == '-b' ]]; then
  BEEP=1
fi

timer() {
  toastify send --id 45 "$1" "$INTERVALMSG"
  termdown -T "$1" "$2"

  if [[ $BEEP -eq 1 ]]; then
    beep -f 5000 -l 50 -r 2
  fi
}

for (( i = 1; i <= ${#INTERVALS[*]}; i++ )); do
  # Highlight (in bold) intervals as they pass
  INTERVALMSG="<b>${INTERVALS[*]:0:i}</b> ${INTERVALS[*]:i}"

  if (( i < ${#INTERVALS[*]} )); then
    breakmsg="$SHORTBREAKMSG"
    breaktime="$SHORTBREAKTIME"
  else
    breakmsg="$LONGBREAKMSG"
    breaktime="$LONGBREAKTIME"
  fi

  timer "$WORKMSG" "$WORKTIME"
  timer "$breakmsg" "$breaktime"
done
